<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OHMAN — Central Essay</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Hamburger toggle -->
  <button id="nav-toggle" class="hamburger">☰ Essays</button>

  <!-- Sidebar menu -->
  <nav id="nav-menu" class="hidden">
    <ul>
      <li><a href="OCCBP.html">OCCBP</a></li>
      <li><a href="index.html">OHMAN</a></li>
      <li><a href="OLP.html">OLP</a></li>
      <li><a href="ORTTYAR.html">ORTTYAR</a></li>
      <li><a href="ORVBUIB.html">ORVBUIB</a></li>
      <li><a href="OWAO.html">OWAO</a></li>
      <li><a href="OWTM.html">OWTM</a></li>
    </ul>
  </nav>

  <!-- Preamble popup -->
  <div id="preamble" class="preamble hidden">
    <div class="preamble-content">
      <h2>Welcome</h2>
      <p>
        This project is a set of letters to myself. The central essay is OHMAN,
        with others branching out from it. Enjoy exploring.
      </p>
      <button id="close-preamble">Close</button>
    </div>
  </div>

  <!-- Main content -->
  <div id="main-content"></div>

  <!-- Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="scripts/expand.js"></script>

  <script>
    async function loadMainEssay() {
      const mainContainer = document.getElementById("main-content");

      // Load main OHMAN essay
      const text = await fetch("content/OHMAN.md").then(r => r.text());
      mainContainer.innerHTML = `<div class="essay-container">${marked.parse(text)}</div>`;

      // Access the ending switcher directly (assumes <span id="ending-switch"> in Markdown)
      const switcher = document.getElementById("ending-switch");
      if (switcher) {
        const endingDiv = document.createElement("div");
        endingDiv.id = "ending-container";
        endingDiv.className = "essay-container ohman-ending";
        mainContainer.appendChild(endingDiv);

        const endings = [
          "content/alt_endings/OHMAN_end1.md",
          "content/alt_endings/OHMAN_end2.md"
        ];
        let currentEnding = Math.random() < 0.5 ? 0 : 1;

        async function showEnding(index) {
          const md = await fetch(endings[index]).then(r => r.text());
          endingDiv.innerHTML = marked.parse(md);
          currentEnding = index;
        }

        // Show one ending initially
        showEnding(currentEnding);

        // Toggle on click
        switcher.addEventListener("click", (e) => {
          e.preventDefault();
          const newIndex = currentEnding === 0 ? 1 : 0;
          showEnding(newIndex);
        });
      }
    }

    // Simple toggle for sidebar
    const toggle = document.getElementById("nav-toggle");
    const nav = document.getElementById("nav-menu");
    toggle.addEventListener("click", () => {
      nav.classList.toggle("visible");
      toggle.classList.toggle("active");
    });

    loadMainEssay();
  </script>
  
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const preamble = document.getElementById("preamble");
    const closeBtn = document.getElementById("close-preamble");

    // Only show if not seen before
    if (!localStorage.getItem("preambleSeen")) {
      preamble.classList.remove("hidden");
    }

    closeBtn.addEventListener("click", () => {
      preamble.classList.add("hidden");
      localStorage.setItem("preambleSeen", "true");
    });
  });
</script>
</body>
</html>