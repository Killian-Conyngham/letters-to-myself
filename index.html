<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OHMAN – Letters to Myself</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Hamburger toggle -->
  <button id="nav-toggle" class="hamburger">☰ Essays</button>

  <!-- Sidebar menu -->
  <nav id="nav-menu" class="hidden">
    <ul>
      <li><a href="OCCBP.html">OCCBP</a></li>
      <li><a href="index.html">OHMAN</a></li>
      <li><a href="OLP.html">OLP</a></li>
      <li><a href="ORTTYAR.html">ORTTYAR</a></li>
      <li><a href="ORVBUIB.html">ORVBUIB</a></li>
      <li><a href="OWAO.html">OWAO</a></li>
      <li><a href="OWTM.html">OWTM</a></li>
    </ul>
  </nav>

  <!-- Preamble popup -->
  <div id="preamble" class="preamble hidden">
    <div class="preamble-content">
      <h2>Welcome</h2>
      <p>
        On this website you will find a series of "letters" I have written to myself. They are linked to eachother throughout. There is no particular order but this piece, 'On Home, Memory, ADEAEN and Narratives' is probably the central one.
      </p>
      <p>
        It's worth noting that this particular collection may be the most self-indulgent thing I have ever written. And that is saying something. My personal feelings about this are: to be loved is to be seen, and if that's what it took to get me writing again then so be it. I hope you will feel somewhat similar, and that there is some value to be found in all these words for yourself. Even if it is as a target to aim your vehement disagreements at. There are many ways to read this text as designed, including or excluding different parts, and it's all far too repetitive to read in one go. So in case you miss it, I want to reiterate the appeal contained in one of the essays for responses, feedback and criticism to any and all thoughts contained herein. These essays are not too far from some of the guiding philosophies I use to live my life, so any constructive criticism is unbelievably useful and absolutely appreciated.
      </p>
      <p>
        Also, regardless of anything else, thanks for taking some time to read any of this. I adore writing words in orders I think others might read and ponder, and you are playing an invaluable part in that process right now.
      </p>
      <p>
        Cheers,
        <br />
        Killian
      </p>
      <button id="close-preamble">Close</button>
    </div>
  </div>

  <!-- Main content -->
  <div id="main-content"></div>

  <!-- Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="scripts/expand.js"></script>

  <script>
    async function loadMainEssay() {
      const mainContainer = document.getElementById("main-content");

      // Load main OHMAN essay
      const text = await fetch("content/OHMAN.md").then(r => r.text());
      mainContainer.innerHTML = `<div class="essay-container">${marked.parse(text)}</div>`;

      // Access the ending switcher directly (assumes <span id="ending-switch"> in Markdown)
      const switcher = document.getElementById("ending-switch");
      if (switcher) {
        const endingDiv = document.createElement("div");
        endingDiv.id = "ending-container";
        endingDiv.className = "essay-container ohman-ending";
        mainContainer.appendChild(endingDiv);

        const endings = [
          "content/alt_endings/OHMAN_end1.md",
          "content/alt_endings/OHMAN_end2.md"
        ];
        let currentEnding = Math.random() < 0.5 ? 0 : 1;

        async function showEnding(index) {
          const md = await fetch(endings[index]).then(r => r.text());
          endingDiv.innerHTML = marked.parse(md);
          currentEnding = index;
        }

        // Show one ending initially
        showEnding(currentEnding);

        // Toggle on click
        switcher.addEventListener("click", (e) => {
          e.preventDefault();
          const newIndex = currentEnding === 0 ? 1 : 0;
          showEnding(newIndex);
        });
      }
    }

    // Simple toggle for sidebar
    const toggle = document.getElementById("nav-toggle");
    const nav = document.getElementById("nav-menu");
    toggle.addEventListener("click", () => {
      nav.classList.toggle("visible");
      toggle.classList.toggle("active");
    });

    loadMainEssay();
  </script>
  
<script>
  window.addEventListener("DOMContentLoaded", () => {
    const preamble = document.getElementById("preamble");
    const closeBtn = document.getElementById("close-preamble");

    // Only show if not seen before
    if (!localStorage.getItem("preambleSeen")) {
      preamble.classList.remove("hidden");
    }

    closeBtn.addEventListener("click", () => {
      preamble.classList.add("hidden");
      localStorage.setItem("preambleSeen", "true");
    });
  });
</script>
</body>
</html>